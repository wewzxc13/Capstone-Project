# Allow cross-origin access to images from specific origins
# This uses SetEnvIf to dynamically set the CORS origin based on the request

# Check if origin matches allowed patterns
SetEnvIf Origin "^https://learnersville\.online$" AccessControlAllowOrigin=$0
SetEnvIf Origin "^https://www\.learnersville\.online$" AccessControlAllowOrigin=$0
SetEnvIf Origin "^https://.*\.vercel\.app$" AccessControlAllowOrigin=$0
SetEnvIf Origin "^http://localhost:3[0-9]{3,}$" AccessControlAllowOrigin=$0
SetEnvIf Origin "^http://localhost:3000$" AccessControlAllowOrigin=$0

# Set CORS headers if origin is allowed
Header set Access-Control-Allow-Origin "%{AccessControlAllowOrigin}e" env=AccessControlAllowOrigin
Header set Access-Control-Allow-Methods "GET, OPTIONS"
Header set Access-Control-Allow-Headers "Content-Type"
Header set Access-Control-Allow-Credentials "true"

# Handle preflight requests
<If "%{REQUEST_METHOD} == 'OPTIONS'">
    Header set Access-Control-Max-Age "86400"
</If>

# Handle image files
<FilesMatch "\.(jpg|jpeg|png|gif|webp)$">
    Header set Content-Type "image/*"
    Header set Cache-Control "public, max-age=31536000"
</FilesMatch>
